# devops

# SSH

ssh-keygen

ssh 

chmod 700

# SSH Tunnel

sudo useradd -m -s /usr/sbin/nologin tunnel
sudo passwd -l tunnel

ssh-keygen -t ed25519 -f tunnel_key

sudo mkdir -p /home/tunnel/.ssh

sudo chown -R tunnel:tunnel /home/tunnel/.ssh
sudo chmod 700 /home/tunnel
sudo chmod 700 /home/tunnel/.ssh

sudo vim /home/tunnel/.ssh/authorized_keys

```jsx
sudo vim /etc/ssh/sshd_config

Match User tunnel
AllowTcpForwarding yes
X11Forwarding no
PermitTTY no
ForceCommand echo "Port forwarding only."
```

```jsx
mkdir -p ~/.config/systemd/user
vim ~/.config/systemd/user/reverse-tunnel.service

[Unit]
Description=Reverse SSH tunnel to oracle
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
ExecStart=/usr/bin/ssh -N -T \
  -R 7700:localhost:9000 \
  tunnel@ssh.leanderziehm.com
Restart=always
RestartSec=10
ExitOnForwardFailure=yes

[Install]
WantedBy=default.target

systemctl --user daemon-reexec
systemctl --user enable reverse-tunnel
systemctl --user start reverse-tunnel

systemctl --user status reverse-tunnel

journalctl --user -u reverse-tunnel -f
```

```jsx
mkdir -p ~/reverse-tunnel

vim ~/reverse-tunnel/ports.conf
# remote:local
7700:localhost:9000
8800:localhost:8080
# add more lines as needed

nvim ~/reverse-tunnel/reverse-tunnel.sh
chmod +x ~/reverse-tunnel/reverse-tunnel.sh

#!/usr/bin/env bash
set -euo pipefail

KEY="$HOME/.ssh/id_ssh-request-leanderziehm-com"
USER_HOST="tunnel@ssh.leanderziehm.com"
PORTS_FILE="$HOME/reverse-tunnel/ports.conf"

ARGS=()

# Read each line from ports.conf
while read -r line; do
    # skip empty lines or comments
    [[ -z "$line" || "$line" =~ ^# ]] && continue
    ARGS+=( -R "$line" )
done < "$PORTS_FILE"

# Run SSH
exec /usr/bin/ssh \
    -i "$KEY" \
    -o IdentitiesOnly=yes \
    -o ServerAliveInterval=30 \
    -o ServerAliveCountMax=3 \
    -o ExitOnForwardFailure=yes \
    -N -T \
    "${ARGS[@]}" \
    "$USER_HOST"
    
    
    
    
    
   vim ~/reverse-tunnel/ports.conf
   systemctl --user restart reverse-tunnel

```

### User lingering

sudo loginctl enable-linger erl

# Wireguard

sudo pacman -S wireguard-tools

```jsx
sudo mkdir -p /etc/wireguard
sudo cp ~/Downloads/wg0.conf /etc/wireguard/
sudo chmod 600 /etc/wireguard/wg0.conf

sudo wg-quick up wg0

```

# Debug Ports Listening

ss -tuln

# Port Forwarding

Network > Subnet > Securety > Securety Rules

## iptables

sudo iptables-save > ~/iptables.rules

sudo vim ~/iptables.rules

80, 443, 5432

sudo iptables-restore < ~/iptables.rules

## postgress

Backup:

pg_dumpall

ALTER USER postgres WITH PASSWORD 'new_password';

 

# Certbot

sudo apt install certbot python3-certbot-nginx

# Wireguard

# Wireguard

https://www.wireguard.com/quickstart/

51820

https://github.com/wg-easy/wg-easy?tab=readme-ov-file

```jsx
sudo apt install wireguard
ip link add dev wg0 type wireguard

sudo ip link set up dev wg0
wg genkey > privatekey
```

48291

## docker compose templates

- umami
- postgres?

pg_dumpall -U postgres -f oracle-2_all_databases_backup.sql

 rsync -avz -P oracle:/var/lib/postgresql/oracle-2_all_databases_backup.sql ~/

 /etc/postgresql/16/main/postgresql.conf

scp oracle:/etc/postgresql/16/main/postgresql.conf ~/

ssh oracle "sudo cat /etc/postgresql/16/main/pg_hba.conf" > ~/pg_hba.conf

scp ./oracle-2_all_databases_backup.sql  oracle:~/

sudo -i -u postgres
psql

# restore

scp ./oracle-2_all_databases_backup.sql  oracle:~/

sudo vim /etc/postgresql/16/main/postgresql.conf

sudo vim /etc/postgresql/16/main/pg_hba.conf

- **`postgresql.conf`** – This is the main PostgreSQL configuration file. The key setting here is:
    
    ```
    listen_addresses = '*'
    
    ```
    
    By default, PostgreSQL only listens on `localhost`. To allow external connections, you need to change it to `'*'` or a specific IP. Also, check the `port` setting (usually `5432`).
    
- **`pg_hba.conf`** – This controls client authentication. For internet access, you need to add entries allowing connections from the IP ranges you want. For example:
    
    ```
    host    all    all    0.0.0.0/0    md5
    
    ```
    
    **⚠ Warning:** `0.0.0.0/0` allows anyone to try connecting. Ideally, restrict it to specific IPs for security.
    

####

ubuntu@oracle-instance-3:~$ cat iptables.rules

# Generated by iptables-save v1.8.10 (nf_tables) on Mon Jan 12 17:09:49 2026

- filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [7784:1618307]
:InstanceServices - [0:0]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp --dport 5432 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
-A OUTPUT -d 169.254.0.0/16 -j InstanceServices
-A InstanceServices -d 169.254.0.2/32 -p tcp -m owner --uid-owner 0 -m tcp --dport 3260 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.2.0/24 -p tcp -m owner --uid-owner 0 -m tcp --dport 3260 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.4.0/24 -p tcp -m owner --uid-owner 0 -m tcp --dport 3260 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.5.0/24 -p tcp -m owner --uid-owner 0 -m tcp --dport 3260 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.0.2/32 -p tcp -m tcp --dport 80 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.169.254/32 -p udp -m udp --dport 53 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.169.254/32 -p tcp -m tcp --dport 53 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.0.3/32 -p tcp -m owner --uid-owner 0 -m tcp --dport 80 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.0.4/32 -p tcp -m tcp --dport 80 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.169.254/32 -p tcp -m tcp --dport 80 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.169.254/32 -p udp -m udp --dport 67 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.169.254/32 -p udp -m udp --dport 69 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.169.254/32 -p udp -m udp --dport 123 -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j ACCEPT
-A InstanceServices -d 169.254.0.0/16 -p tcp -m tcp -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j REJECT --reject-with tcp-reset
-A InstanceServices -d 169.254.0.0/16 -p udp -m udp -m comment --comment "See the Oracle-Provided Images section in the Oracle Cloud Infrastructure documentation for security impact of modifying or removing this rule" -j REJECT --reject-with icmp-port-unreachable
COMMIT

# Completed on Mon Jan 12 17:09:49 2026

